document.addEventListener('DOMContentLoaded', () => {
  function t(t) {
    const n = document.createElement('textarea');
    (n.value = t),
      (n.style.position = 'fixed'),
      (n.style.left = '-999999px'),
      (n.style.top = '-999999px'),
      document.body.appendChild(n),
      n.focus(),
      n.select();
    try {
      document.execCommand('copy'), e('âœ… å·²å¤åˆ¶: ' + t);
    } catch (t) {
      e('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
    }
    document.body.removeChild(n);
  }
  function e(t) {
    const e = document.querySelector('.toast');
    e && e.remove();
    const n = document.createElement('div');
    (n.className = 'toast'),
      (n.textContent = t),
      document.body.appendChild(n),
      setTimeout(() => n.classList.add('show'), 10),
      setTimeout(() => {
        n.classList.remove('show'), setTimeout(() => n.remove(), 300);
      }, 3e3);
  }
  function n(t, e) {
    const n = document.getElementById(t);
    n && (n.className = 'status-indicator status-' + e);
  }
  async function a() {
    n('status-ipip', 'loading');
    const t = document.querySelector('#status-ipip').parentElement,
      e = [
        {
          name: 'speedtest.cn',
          url: 'https://api-v3.speedtest.cn/ip',
          parser: (t) => {
            if (0 === t.code && t.data)
              return {
                ip: t.data.ip || 'æœªçŸ¥',
                country: t.data.country || 'æœªçŸ¥',
                city: t.data.city || 'æœªçŸ¥',
              };
            throw new Error('æ•°æ®æ ¼å¼é”™è¯¯');
          },
        },
        {
          name: 'ipipv.com',
          url: 'https://myip.ipipv.com/',
          parser: (t) => ({
            ip: t.Ip || 'æœªçŸ¥',
            country: t.Country || 'æœªçŸ¥',
            city: t.City || 'æœªçŸ¥',
          }),
        },
        {
          name: 'ipip.net',
          url: 'https://myip.ipip.net/json',
          parser: (t) => {
            if ('ok' === t.ret && t.data)
              return {
                ip: t.data.ip || 'æœªçŸ¥',
                country: t.data.location[0] || 'æœªçŸ¥',
                city: t.data.location[2] || 'æœªçŸ¥',
              };
            throw new Error('æ•°æ®æ ¼å¼é”™è¯¯');
          },
        },
      ];
    for (const a of e)
      try {
        const e = Date.now(),
          s = a.url + (a.url.includes('?') ? '&' : '?') + `t=${e}`,
          i = await fetch(s),
          l = await i.json(),
          c = a.parser(l);
        return (
          (document.getElementById('ipip-ip').textContent = c.ip),
          (document.getElementById('ipip-country').textContent = c.country),
          (document.getElementById('ipip-city').textContent = c.city),
          n('status-ipip', 'success'),
          t &&
            ((t.innerHTML = `<span class="status-indicator" id="status-ipip"></span>å›½å†…æµ‹è¯•ï¼ˆ${a.name}ï¼‰`),
            n('status-ipip', 'success')),
          void console.log(`ä½¿ç”¨ ${a.name} API æˆåŠŸ`)
        );
      } catch (t) {
        console.warn(`${a.name} æ¥å£å¤±è´¥:`, t);
      }
    (document.getElementById('ipip-ip').innerHTML =
      '<span class="error">åŠ è½½å¤±è´¥</span>'),
      (document.getElementById('ipip-country').textContent = ''),
      (document.getElementById('ipip-city').textContent = ''),
      n('status-ipip', 'error'),
      console.error('æ‰€æœ‰å›½å†…æµ‹è¯• API éƒ½å¤±è´¥');
  }
  async function s() {
    n('status-edgeone', 'loading');
    try {
      const t = await fetch('https://api.ipapi.cmliussss.net'),
        e = await t.json();
      (document.getElementById('edgeone-ip').textContent = e.ip || 'æœªçŸ¥'),
        (document.getElementById('edgeone-country').textContent =
          e.location.country_code || 'æœªçŸ¥'),
        (document.getElementById('edgeone-city').textContent =
          `AS${e.asn.asn} ${e.asn.org}` || 'æœªçŸ¥'),
        n('status-edgeone', 'success');
    } catch (t) {
      (document.getElementById('edgeone-ip').innerHTML =
        '<span class="error">åŠ è½½å¤±è´¥</span>'),
        (document.getElementById('edgeone-country').textContent = ''),
        (document.getElementById('edgeone-city').textContent = ''),
        n('status-edgeone', 'error'),
        console.error('EdgeOne æ¥å£é”™è¯¯:', t);
    }
  }
  async function i() {
    n('status-cf', 'loading');
    try {
      const t = Date.now(),
        e = await fetch(`https://cf.090227.xyz/ip.json?t=${t}`),
        a = await e.json();
      (document.getElementById('cf-ip').textContent = a.ip || 'æœªçŸ¥'),
        (document.getElementById('cf-country').textContent =
          a.country || 'æœªçŸ¥'),
        (document.getElementById('cf-city').textContent = a.org || 'æœªçŸ¥'),
        n('status-cf', 'success');
    } catch (t) {
      (document.getElementById('cf-ip').innerHTML =
        '<span class="error">åŠ è½½å¤±è´¥</span>'),
        (document.getElementById('cf-country').textContent = ''),
        (document.getElementById('cf-city').textContent = ''),
        n('status-cf', 'error'),
        console.error('CloudFlare æ¥å£é”™è¯¯:', t);
    }
  }
  async function l() {
    n('status-twitter', 'loading');
    try {
      const t = Date.now(),
        e = await fetch(`https://x.com/cdn-cgi/trace?t=${t}`),
        a = await e.text(),
        s = {};
      a.split('\n').forEach((t) => {
        const [e, n] = t.split('=');
        e && n && (s[e.trim()] = n.trim());
      }),
        (document.getElementById('twitter-ip').textContent = s.ip || 'æœªçŸ¥'),
        (document.getElementById('twitter-country').textContent =
          s.loc || 'æœªçŸ¥'),
        (document.getElementById('twitter-city').textContent = s.colo || ''),
        n('status-twitter', 'success');
    } catch (t) {
      (document.getElementById('twitter-ip').innerHTML =
        '<span class="error">åŠ è½½å¤±è´¥</span>'),
        (document.getElementById('twitter-country').textContent = ''),
        (document.getElementById('twitter-city').textContent = ''),
        n('status-twitter', 'error'),
        console.error('æ¨ç‰¹å…¥å£æ¥å£é”™è¯¯:', t);
    }
  }
  async function c() {
    document.querySelector('.network-cards-container') &&
      (await Promise.all([a(), s(), i(), l()]),
      document.querySelectorAll('.ip-text').forEach((t) => {
        const e = t.textContent.trim();
        t.querySelector('.error') ||
          'åŠ è½½ä¸­...' === e ||
          'æœªçŸ¥' === e ||
          t.classList.contains('clickable') ||
          t.classList.add('clickable');
      }));
  }
  async function o(t) {
    let n = t.textContent.trim();
    if (t.querySelector('.loading-spinner')) return;
    if ('åŠ è½½ä¸­...' === n || 'æœªçŸ¥' === n) return;
    const a = n.replace(/\*/g, '0'),
      s = document.createElement('span');
    (s.className = 'loading-spinner'), t.appendChild(s);
    try {
      const t = await fetch(`https://api.ipapi.cmliussss.net/?ip=${a}`);
      if (!t.ok) throw new Error('æŸ¥è¯¢å¤±è´¥');
      const e = await t.json();
      s.remove(),
        (function (t) {
          const e = document.createElement('div');
          e.className = 'ip-detail-modal';
          const n = t.company?.abuser_score,
            a = t.asn?.abuser_score,
            s = {
              is_crawler: t.is_crawler,
              is_proxy: t.is_proxy,
              is_vpn: t.is_vpn,
              is_tor: t.is_tor,
              is_abuser: t.is_abuser,
              is_bogon: t.is_bogon,
            },
            i = (function (t, e, n = {}) {
              (t && 'æœªçŸ¥' !== t) || (t = 0);
              (e && 'æœªçŸ¥' !== e) || (e = 0);
              const a = parseFloat(t) || 0,
                s = parseFloat(e) || 0;
              let i = ((a + s) / 2) * 5,
                l = 0;
              const c = [
                  n.is_crawler,
                  n.is_proxy,
                  n.is_vpn,
                  n.is_tor,
                  n.is_abuser,
                  n.is_bogon,
                ],
                o = c.filter((t) => !0 === t).length;
              l = 0.15 * o;
              const p = i + l;
              return 0 === i && 0 === l ? null : p;
            })(n, a, s);
          let l = '';
          if (null !== i) {
            const t = 100 * i,
              e =
                null == (c = t)
                  ? 'badge-info'
                  : c >= 100
                  ? 'badge-critical'
                  : c >= 20
                  ? 'badge-high'
                  : c >= 5
                  ? 'badge-elevated'
                  : c >= 0.25
                  ? 'badge-low'
                  : 'badge-verylow',
              n = (function (t) {
                if (null == t) return 'æœªçŸ¥';
                const e = 100 * t;
                return e.toFixed(2) + '%';
              })(i);
            let a = '';
            (a =
              t >= 100
                ? 'æåº¦å±é™©'
                : t >= 20
                ? 'é«˜é£é™©'
                : t >= 5
                ? 'è½»å¾®é£é™©'
                : t >= 0.25
                ? 'çº¯å‡€'
                : 'æåº¦çº¯å‡€'),
              (l = `\n            <span class="ip-detail-badge ${e}">${n} ${a}</span>\n        `);
          } else l = 'æœªçŸ¥';
          var c;
          let o =
            '\n        <div class="ip-detail-content">\n            <button class="ip-detail-close" aria-label="å…³é—­å¼¹çª—">Ã—</button>\n            <div class="ip-detail-title">\n                ğŸ” IP è¯¦ç»†ä¿¡æ¯\n                <span class="ip-detail-source">æ•°æ®æ¥æº: ipapi.is</span>\n            </div>\n    ';
          (o += `\n        <div class="ip-detail-section">\n            <div class="ip-detail-section-title">ğŸ“ åŸºæœ¬ä¿¡æ¯</div>\n            <div class="ip-detail-item">\n                <span class="ip-detail-label">IP åœ°å€</span>\n                <span class="ip-detail-value">${
            t.ip || 'æœªçŸ¥'
          }</span>\n            </div>\n            <div class="ip-detail-item">\n                <span class="ip-detail-label">åŒºåŸŸäº’è”ç½‘æ³¨å†Œæœºæ„</span>\n                <span class="ip-detail-value">${
            t.rir || 'æœªçŸ¥'
          }</span>\n            </div>\n            <div class="ip-detail-item">\n                <span class="ip-detail-label">è¿è¥å•† / ASN ç±»å‹</span>\n                <span class="ip-detail-value">${p(
            t.company?.type
          )} / ${p(
            t.asn?.type
          )}</span>\n            </div>\n            <div class="ip-detail-item">\n                <span class="ip-detail-label">\n                    ç»¼åˆæ»¥ç”¨è¯„åˆ†\n                    <span class="score-help-icon" title="ç‚¹å‡»æŸ¥çœ‹ç®—æ³•è¯´æ˜">?</span>\n                    <span class="score-tooltip">\n                        <div class="tooltip-header">\n                            <span class="tooltip-title">ğŸ“Š ç»¼åˆæ»¥ç”¨è¯„åˆ†ç®—æ³•</span>\n                        </div>\n                        <div class="tooltip-section">\n                            <p class="tooltip-section-title">è¯„åˆ†å…¬å¼</p>\n                            <div class="formula-item">\n                                <span class="formula-name">åŸºç¡€åˆ†</span>\n                                <span class="formula-equation"><code>(è¿è¥å•†åˆ† + ASNåˆ†) / 2 * 5</code></span>\n                            </div>\n                            <div class="formula-item">\n                                <span class="formula-name">é£é™©é™„åŠ </span>\n                                <span class="formula-equation"><code>é£é™©é¡¹æ•°é‡ * 15%</code></span>\n                            </div>\n                        </div>\n                        <div class="tooltip-section">\n                            <p class="tooltip-section-title">å®‰å…¨é£é™©é¡¹</p>\n                            <ul class="risk-list">\n                                <li>çˆ¬è™« (Crawler)</li>\n                                <li>ä»£ç† (Proxy)</li>\n                                <li>VPN</li>\n                                <li>Tor ç½‘ç»œ</li>\n                                <li>æ»¥ç”¨IP (Abuser)</li>\n                                <li>è™šå‡IP (Bogon)</li>\n                            </ul>\n                        </div>\n                    </span>\n                </span>\n                <span class="ip-detail-value">${l}</span>\n            </div>\n        </div>\n    `),
            (o += `\n        <div class="ip-detail-section">\n            <div class="ip-detail-section-title">ğŸ›¡ï¸ å®‰å…¨æ£€æµ‹</div>\n            <div class="ip-detail-item">\n                <span class="ip-detail-label">ç§»åŠ¨ç½‘ç»œ</span>\n                <span class="ip-detail-value">${
              t.is_mobile ? '<span class="success-text">ğŸ“± æ˜¯</span>' : 'å¦'
            }</span>\n            </div>\n            <div class="ip-detail-item">\n                <span class="ip-detail-label">æ•°æ®ä¸­å¿ƒ</span>\n                <span class="ip-detail-value">${
              t.is_datacenter ? '<span class="warning-text">ğŸ¢ æ˜¯</span>' : 'å¦'
            }</span>\n            </div>\n            <div class="ip-detail-item">\n                <span class="ip-detail-label">å«æ˜Ÿç½‘ç»œ</span>\n                <span class="ip-detail-value">${
              t.is_satellite ? '<span class="success-text">ğŸ›°ï¸ æ˜¯</span>' : 'å¦'
            }</span>\n            </div>\n            <div class="ip-detail-item">\n                <span class="ip-detail-label">çˆ¬è™«</span>\n                <span class="ip-detail-value">${
              t.is_crawler ? '<span class="danger-text">ğŸ¤– æ˜¯</span>' : 'âœ… å¦'
            }</span>\n            </div>\n            <div class="ip-detail-item">\n                <span class="ip-detail-label">ä»£ç†æœåŠ¡å™¨</span>\n                <span class="ip-detail-value">${
              t.is_proxy ? '<span class="danger-text">âš ï¸ æ˜¯</span>' : 'âœ… å¦'
            }</span>\n            </div>\n            <div class="ip-detail-item">\n                <span class="ip-detail-label">VPN</span>\n                <span class="ip-detail-value">${
              t.is_vpn ? '<span class="danger-text">âš ï¸ æ˜¯</span>' : 'âœ… å¦'
            }</span>\n            </div>\n            <div class="ip-detail-item">\n                <span class="ip-detail-label">Tor ç½‘ç»œ</span>\n                <span class="ip-detail-value">${
              t.is_tor ? '<span class="danger-text">âš ï¸ æ˜¯</span>' : 'âœ… å¦'
            }</span>\n            </div>\n            <div class="ip-detail-item">\n                <span class="ip-detail-label">æ»¥ç”¨ IP</span>\n                <span class="ip-detail-value">${
              t.is_abuser ? '<span class="danger-text">âš ï¸ æ˜¯</span>' : 'âœ… å¦'
            }</span>\n            </div>\n            <div class="ip-detail-item">\n                <span class="ip-detail-label">è™šå‡ IP</span>\n                <span class="ip-detail-value">${
              t.is_bogon ? '<span class="danger-text">âš ï¸ æ˜¯</span>' : 'âœ… å¦'
            }</span>\n            </div>\n        </div>\n    `),
            t.location &&
              (o += `\n            <div class="ip-detail-section">\n                <div class="ip-detail-section-title">ğŸŒ ä½ç½®ä¿¡æ¯</div>\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">å›½å®¶</span>\n                    <span class="ip-detail-value">${
                t.location.country || 'æœªçŸ¥'
              } (${
                t.location.country_code || '-'
              })</span>\n                </div>\n                ${
                t.location.state
                  ? `\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">çœä»½/å·</span>\n                    <span class="ip-detail-value">${t.location.state}</span>\n                </div>\n                `
                  : ''
              }\n                ${
                t.location.city
                  ? `\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">åŸå¸‚</span>\n                    <span class="ip-detail-value">${t.location.city}</span>\n                </div>\n                `
                  : ''
              }\n                ${
                t.location.zip
                  ? `\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">é‚®ç¼–</span>\n                    <span class="ip-detail-value">${t.location.zip}</span>\n                </div>\n                `
                  : ''
              }\n                ${
                t.location.latitude && t.location.longitude
                  ? `\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">åæ ‡</span>\n                    <span class="ip-detail-value">${t.location.latitude}, ${t.location.longitude}</span>\n                </div>\n                `
                  : ''
              }\n                ${
                t.location.timezone
                  ? `\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">æ—¶åŒº</span>\n                    <span class="ip-detail-value">${t.location.timezone}</span>\n                </div>\n                `
                  : ''
              }\n                ${
                t.location.local_time
                  ? `\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">å½“åœ°æ—¶é—´</span>\n                    <span class="ip-detail-value">${t.location.local_time}</span>\n                </div>\n                `
                  : ''
              }\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">æ¬§ç›Ÿæˆå‘˜</span>\n                    <span class="ip-detail-value">${(function (
                t,
                e = 'âœ…',
                n = 'âŒ'
              ) {
                return t ? e : n;
              })(
                t.location.is_eu_member,
                'ğŸ‡ªğŸ‡º æ˜¯',
                'å¦'
              )}</span>\n                </div>\n            </div>\n        `);
          if (t.company) {
            const e = t.company.abuser_score || 'æœªçŸ¥',
              n = d(e);
            o += `\n            <div class="ip-detail-section">\n                <div class="ip-detail-section-title">ğŸ¢ è¿è¥å•†ä¿¡æ¯</div>\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">è¿è¥å•†åç§°</span>\n                    <span class="ip-detail-value">${
              t.company.name || 'æœªçŸ¥'
            }</span>\n                </div>\n                ${
              t.company.domain
                ? `\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">åŸŸå</span>\n                    <span class="ip-detail-value">${t.company.domain}</span>\n                </div>\n                `
                : ''
            }\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">ç±»å‹</span>\n                    <span class="ip-detail-value">${
              t.company.type || 'æœªçŸ¥'
            }</span>\n                </div>\n                ${
              t.company.network
                ? `\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">ç½‘ç»œèŒƒå›´</span>\n                    <span class="ip-detail-value">${t.company.network}</span>\n                </div>\n                `
                : ''
            }\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">æ»¥ç”¨è¯„åˆ†</span>\n                    <span class="ip-detail-value"><span class="ip-detail-badge ${n}">${e}</span></span>\n                </div>\n            </div>\n        `;
          }
          if (t.asn) {
            const e = t.asn.abuser_score || 'æœªçŸ¥',
              n = d(e);
            o += `\n            <div class="ip-detail-section">\n                <div class="ip-detail-section-title">ğŸ”¢ ASN ä¿¡æ¯</div>\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">ASN ç¼–å·</span>\n                    <span class="ip-detail-value">AS${
              t.asn.asn || 'æœªçŸ¥'
            }</span>\n                </div>\n                ${
              t.asn.org
                ? `\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">ç»„ç»‡</span>\n                    <span class="ip-detail-value">${t.asn.org}</span>\n                </div>\n                `
                : ''
            }\n                ${
              t.asn.route
                ? `\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">è·¯ç”±</span>\n                    <span class="ip-detail-value">${t.asn.route}</span>\n                </div>\n                `
                : ''
            }\n                ${
              t.asn.type
                ? `\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">ç±»å‹</span>\n                    <span class="ip-detail-value">${t.asn.type}</span>\n                </div>\n                `
                : ''
            }\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">æ»¥ç”¨è¯„åˆ†</span>\n                    <span class="ip-detail-value"><span class="ip-detail-badge ${n}">${e}</span></span>\n                </div>\n                ${
              t.asn.country
                ? `\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">å›½å®¶ä»£ç </span>\n                    <span class="ip-detail-value">${t.asn.country.toUpperCase()}</span>\n                </div>\n                `
                : ''
            }\n            </div>\n        `;
          }
          t.abuse &&
            (o += `\n            <div class="ip-detail-section">\n                <div class="ip-detail-section-title">ğŸ“§ æ»¥ç”¨ä¸¾æŠ¥è”ç³»æ–¹å¼</div>\n                ${
              t.abuse.name
                ? `\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">è”ç³»äºº</span>\n                    <span class="ip-detail-value">${t.abuse.name}</span>\n                </div>\n                `
                : ''
            }\n                ${
              t.abuse.email
                ? `\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">é‚®ç®±</span>\n                    <span class="ip-detail-value">${t.abuse.email}</span>\n                </div>\n                `
                : ''
            }\n                ${
              t.abuse.phone
                ? `\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">ç”µè¯</span>\n                    <span class="ip-detail-value">${t.abuse.phone}</span>\n                </div>\n                `
                : ''
            }\n                ${
              t.abuse.address
                ? `\n                <div class="ip-detail-item">\n                    <span class="ip-detail-label">åœ°å€</span>\n                    <span class="ip-detail-value">${t.abuse.address}</span>\n                </div>\n                `
                : ''
            }\n            </div>\n        `);
          (o += '</div>'), (e.innerHTML = o), document.body.appendChild(e);
        })(e);
    } catch (t) {
      s.remove(), e('âŒ æŸ¥è¯¢IPè¯¦ç»†ä¿¡æ¯å¤±è´¥'), console.error('IPæŸ¥è¯¢é”™è¯¯:', t);
    }
  }
  function p(t) {
    if (!t) return '<span class="ip-type-unknown">æœªçŸ¥</span>';
    const e = {
      isp: { text: 'ä½å®…', class: 'ip-type-residential' },
      hosting: { text: 'æœºæˆ¿', class: 'ip-type-hosting' },
      business: { text: 'å•†ç”¨', class: 'ip-type-business' },
    }[t.toLowerCase()] || { text: t, class: 'ip-type-unknown' };
    return `<span class="${e.class}">${e.text}</span>`;
  }
  function d(t) {
    if (!t) return 'badge-info';
    const e = parseFloat(t);
    return e < 0.001
      ? 'badge-success'
      : e < 0.01
      ? 'badge-info'
      : e < 0.1
      ? 'badge-warning'
      : 'badge-danger';
  }
  function r() {
    document.body.addEventListener('click', (n) => {
      const a = n.target.closest('.copy-domain');
      if (a) {
        const n = a.dataset.domain;
        return void (
          n &&
          (function (n) {
            const a = n.replace(/^\*\./, '');
            navigator.clipboard && navigator.clipboard.writeText
              ? navigator.clipboard
                  .writeText(a)
                  .then(() => {
                    e('âœ… å·²å¤åˆ¶: ' + a);
                  })
                  .catch((e) => {
                    t(a);
                  })
              : t(a);
          })(n)
        );
      }
      const s = n.target.closest('.ip-text.clickable');
      if (s) return void o(s);
      const i = n.target.closest('.score-help-icon');
      if (i)
        return (
          n.stopPropagation(),
          void (function (t) {
            const e = t.nextElementSibling;
            e.classList.contains('show'),
              document.querySelectorAll('.score-tooltip.show').forEach((t) => {
                t !== e && t.classList.remove('show');
              }),
              e.classList.toggle('show');
          })(i)
        );
      const l = n.target.closest('.ip-detail-close');
      if (l) return void l.closest('.ip-detail-modal').remove();
      if (n.target.classList.contains('ip-detail-modal'))
        return (
          n.target.remove(),
          void document
            .querySelectorAll('.score-tooltip.show')
            .forEach((t) => t.classList.remove('show'))
        );
      const c = document.querySelector('.score-tooltip.show');
      c && !c.contains(n.target) && c.classList.remove('show');
    }),
      document.addEventListener('keydown', (t) => {
        if ('Escape' === t.key) {
          const t = document.querySelector('.ip-detail-modal');
          t && t.remove();
          const e = document.querySelector('.score-tooltip.show');
          e && e.classList.remove('show');
        }
      });
  }
  !(function () {
    const t = document.getElementById('theme-switcher');
    t &&
      (window.matchMedia &&
        window
          .matchMedia('(prefers-color-scheme: dark)')
          .addEventListener('change', (t) => {
            if (!localStorage.getItem('theme')) {
              const e = t.matches ? 'dark' : 'light';
              document.documentElement.setAttribute('data-theme', e);
            }
          }),
      t.addEventListener('click', () => {
        const t =
          'dark' === document.documentElement.getAttribute('data-theme')
            ? 'light'
            : 'dark';
        document.documentElement.setAttribute('data-theme', t),
          localStorage.setItem('theme', t);
      }));
  })(),
    (function () {
      const t = document.querySelectorAll('.lazy-image');
      if (!t.length) return;
      const e = new IntersectionObserver(
        (t, e) => {
          t.forEach((t) => {
            if (t.isIntersecting) {
              const n = t.target,
                a = n.getAttribute('data-src');
              if (a) {
                const t = new Image();
                (t.onload = () => {
                  (n.src = a),
                    n.removeAttribute('data-src'),
                    setTimeout(() => {
                      n.classList.add('loaded');
                    }, 50);
                }),
                  (t.onerror = () => {
                    n.classList.add('loaded');
                  }),
                  (t.src = a);
              }
              e.unobserve(n);
            }
          });
        },
        { rootMargin: '200px', threshold: 0.01 }
      );
      t.forEach((t) => {
        e.observe(t);
      });
    })(),
    c(),
    (async function () {
      try {
        const t = await fetch(
            'https://tongji.090227.xyz/?id=ipcheckinfo.zone.id'
          ),
          e = await t.json(),
          n = document.getElementById('visit-count');
        n && void 0 !== e.visitCount && (n.textContent = e.visitCount);
      } catch (t) {
        console.error('è·å–è®¿é—®ç»Ÿè®¡å¤±è´¥:', t);
        const e = document.getElementById('visit-count');
        e && (e.textContent = 'åŠ è½½å¤±è´¥');
      }
    })(),
    r();
});
